// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Proje Modeli (Aynı Kalıyor)
model Project {
  id        String   @id @default(cuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tests     Test[]
}

// YENİ TABLO: Senaryo Kütüphanemiz
model Scenario {
  id            String  @id @default(cuid())
  name          String  @unique // Örn: "User Login", "Browse Homepage"
  description   String  @db.Text
  
  // k6 script'inin 'export function SENARYO_ADI() { ... }' kısmını içeren parça
  scriptFragment String  @db.Text 

  // Bu senaryonun ait olduğu testler (Çoka Çok İlişki)
  tests         Test[]    @relation("TestScenarios")
}


// GÜNCELLENEN TABLO: Test Modelimiz
model Test {
  id        String   @id @default(cuid())
  name      String   // Örn: "E-Ticaret Sitesi Tam Yük Testi"
  
  // k6'nın 'options' objesini burada JSON olarak saklayacağız
  options   Json
  
  // Kullanıcının "Benim testim 'https://my-site.com' adresini hedef alacak"
  // demesini sağlayan alan.
  targetBaseUrl String?  // Opsiyonel (?) yaptık, belki bazı testler istemez

  // İlişki: Bu testin hangi senaryoları içerdiğini tutar
  scenarios Scenario[] @relation("TestScenarios")

  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  runs      TestRun[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// TestRun Modeli (Aynı Kalıyor)
model TestRun {
  id        String   @id @default(cuid())
  status    String   @default("PENDING")
  createdAt DateTime @default(now())
  endedAt   DateTime?
  testId String
  test   Test     @relation(fields: [testId], references: [id], onDelete: Cascade)
  resultSummary Json?
}